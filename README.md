# MathExpr
[ Презентация ](https://drive.google.com/file/d/10IOaLl45j8MSrfYfZh08B_4K0Da0HxRk/view?usp=sharing)

##Введение
Данная программа является парсером на основе ANTLR4 и демонстрирует создание AST дерева на основе грамматического файла ANTLR.

##Сборка проекта
Для сборки проекта достаточно просто использовать команду mvn install. Плагин ANTLR4 автоматически сгенерирует всё необходимое.  
Однако, если вы поменяете структуру antlr4/, то вы измените пакеты сгенерированных файлов. Это стоит учитывать при самостоятельной работе.

##Принцип работы
####Структура программы
На основе грамматического файла ANTLR генерирует классы лексического дерева(ParseTree) и его обходчиков(Visitor).
С помощью этого дерева и изменении поведения обходчика можно сделать алгоритм создания AST дерева.  
Все узлы дерева прописываются самостоятельно, т.к. ANTLR за это не отвечает.   
В данном примере класс каждого узла показывает, какое действие выполняется.  
Узлы дерева представлены следующей структурой:
- ASTNode - базовый класс узла AST дерева, от которого наследуются все остальные;
- ASTProgramNode - класс узла, который ссылается на все инструкции в программе(read, assign и write);
- ASTReadNode - класс узла, отображающий инструкцию ввода с консоли;
- ASTWriteNode - класс узла, отображающий инструкцию вывода на консоль;
- ASTAssignNode - класс узла, отображающий инструкцию присвоения переменной значения;
- ASTBinOpNode - класс узла, отображающий основные бинарные операторы(+, -, *, /);
- ASTVarNode и ASTConstNode - классы узлов, отображающий переменные(var) и константы(const);
Также есть класс узла для операции отрицания ASTNegateNode.
  
####Работа ASTBuilder
ASTBuilder посещает каждый узел лексического дерева и возвращает узел AST дерева в качестве результата.  
Т.к. большинство правил являются группировкой основных действий в программе(+,-,*,/,=,read,write), то узлы AST дерева создаются в результате обработки именно этих правил.
Другие правила лишь рекурсивно вызывают обработку дочерних узлов лексического дерева, чтобы получить узлы AST дерева, и формирутют его структуру.  
Так, в обработке правил expression и term необходимо список подправил преобразовать в правильную часть дерева.
В некоторых случаях работа программы остаётся неизменной(по сравнению с исходным обходчиком, который просто посещает каждый узел лексического дерева).